{% load static %}
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f2f5;
            color: #333;
            overflow-x: hidden;
        }
        .dashboard {
            display: flex;
            min-height: 100vh;
            max-width: 1400px;
            margin: 0 auto;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            padding-top: 12px;  /* æ·»åŠ è¿™ä¸€è¡Œï¼Œè®©å®ƒé¿å¼€å¯¼èˆªæ  */
        }
        .left-panel {
            flex: 1;
            background-color: #fff;
            padding: 20px;
            border-right: 1px solid #eee;
            display: flex;
            flex-direction: column;
        }
        .right-panel {
            flex: 1.2;
            padding: 20px;
            background-color: #fff;
        }
        .car-view {
            text-align: center;
            position: relative;
            margin-bottom: 0px;
            margin-top: 20px;
            height: 560px;
        }
        .car-status {
            font-size: 60px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .car-image {
            max-width: 70%;
            margin: 0 auto;
        }
        .car-controls {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        .control-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            border: none;
            cursor: pointer;
        }
        .control-btn.active {
            background-color: #1890ff;
            color: white;
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(24,144,255,0.3);
        }
        .media-player {
            background-color: #f9f9f9;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }
        .media-info {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .media-thumbnail {
            width: 50px;
            height: 50px;
            border-radius: 5px;
            background-color: #ddd;
            margin-right: 10px;
        }
        .media-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }
        .media-btn {
            border: none;
            background: none;
            cursor: pointer;
            font-size: 20px;
            color: #666;
        }
        #title {
            font-size: 20px;
            font-weight: 600;
            color: #222;
            margin-bottom: 4px;
        }
        #artist {
            font-size: 14px;
            color: #777;
        }
        .progress-container {
            width: 100%;
            height: 8px;
            background: #eee;
            border-radius: 4px;
            margin-top: 10px;
            cursor: pointer;
            position: relative;
        }
        .progress {
            height: 100%;
            width: 0%;
            background: linear-gradient(to right, #ff6a00, #ffb347);
            border-radius: 4px;
            transition: width 0.2s linear;
        }

        .section-title {
            font-size: 16px;
            color: #666;
            margin: 20px 0 15px;
        }
        .app-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        .app-grid a {
            text-decoration: none;
            color: inherit;
        }
        .app-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .app-icon:hover {
            transform: scale(1.05);
        }
        .app-icon-img {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background-color: #e6f7ff;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px;
            color: #1890ff;
        }
        .app-icon-img.blue {
            background-color: #e6f7ff;
            color: #1890ff;
        }
        .app-icon-img.green {
            background-color: #e6ffe6;
            color: #52c41a;
        }
        .app-icon-img.orange {
            background-color: #fff7e6;
            color: #fa8c16;
        }
        .app-icon-img.purple {
            background-color: #f9f0ff;
            color: #722ed1;
        }
        .app-icon-img.red {
            background-color: #fff1f0;
            color: #f5222d;
        }
        .app-icon-img.grey {
            background-color: #f5f5f5;
            color: #666;
        }
        .app-name {
            font-size: 12px;
            color: #666;
        }
        .bottom-controls {
            display: flex;
            justify-content: space-between;
            padding-top: 0px;
            margin-top: 0px;
        }
        .temp-control {
            display: flex;
            height: 60px;
            align-items: center;
            margin-bottom: 20px;
        }
        .temp-value {
            font-size: 18px;
            margin: 0 10px;
        }
        .line {
            border-bottom: 1px solid #eee;
        }
        .weather-widget {
            width: 100%;
            border-radius: 16px;
            overflow: hidden;
            box-sizing: border-box;
            margin-top: 10px;
        }


        .status-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 98%;
            height: 32px;
            background-color: #fff;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .status-left {
            display: flex;
            gap: 16px;
            align-items: center;
            flex-shrink: 0;
        }
        .status-right {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-shrink: 0;
        }
        .status-icon {
            width: 16px;
            height: 16px;
            object-fit: contain;
        }
        .status-right a {
            color: #1890ff !important;
            text-decoration: none;
            font-weight: 500;
            padding: 2px 8px;
            border-radius: 6px;
            transition: background 0.2s, color 0.2s;
        }

        .status-right a:hover {
            background-color: #e6f7ff;
            color: #096dd9;
            text-decoration: none;
        }

    </style>
</head>
<body>
    <div class="dashboard">
        <div class="status-bar">
            <div class="status-left">
                <img src="{% static 'P.png' %}" alt="P" class="status-icon">
                <img src="{% static 'rain.png' %}" alt="rain" class="status-icon">
                <img src="{% static 'light.png' %}" alt="light" class="status-icon">
            </div>
            <div class="status-right">
                <img src="{% static 'location.svg' %}" alt="ä½ç½®" class="status-icon">
                <img src="{% static 'volume.svg' %}" alt="éŸ³é‡" class="status-icon">
                <img src="{% static 'wifi.svg' %}" alt="ä¿¡å·" class="status-icon">
                <span id="current-time">--:--</span>
                 <!-- ç™»å½•/æ³¨å†Œæˆ–ç”¨æˆ·ä¿¡æ¯ -->
                {% if user.is_authenticated %}
                    <span style="margin-left: 10px; font-size: 14px;">æ¬¢è¿ï¼Œ{{ user.username }}</span>
                    <a href="{% url 'logout' %}" style="margin-left: 10px; font-size: 14px;">é€€å‡º</a>
                {% else %}
                    <a href="{% url 'login' %}" style="margin-left: 10px; font-size: 14px;">ç™»å½•</a>
                    <a href="{% url 'register' %}" style="margin-left: 10px; font-size: 14px;">æ³¨å†Œ</a>
                {% endif %}
            </div>
        </div>
        <div class="left-panel">
            <div class="car-view">
                <div id="map-container" style="width: 100%; height: 100%;"></div>
            </div>
            
            <div class="media-player">
                <div class="media-info">
                    <img id="cover" class="media-thumbnail" src="{% static 'music/cover1.jpg' %}" alt="å°é¢">
                    <div>
                        <div id="title">æµ®å…‰</div>
                        <div id="artist">å‘¨æ·±</div>
                    </div>
                </div>
                <div class="progress-container" id="progressContainer">
                    <div class="progress" id="progress"></div>
                </div>
                <div class="media-controls">
                    <button class="media-btn" id="prevBtn">â®ï¸</button>
                    <button class="media-btn play-btn" id="playBtn">â–¶ï¸</button>
                    <button class="media-btn" id="nextBtn">â­ï¸</button>
                    <button class="media-btn">â¤ï¸</button>
                    <button class="media-btn">ğŸ”„</button>
                </div>
            </div>
        </div>

        <div class="right-panel">
            <div class="section-title">æœ€è¿‘åº”ç”¨</div>
            <div class="app-grid">
                <a href="/car/" class="app-icon">
                    <div class="app-icon-img blue">ğŸš—</div>
                    <div class="app-name">è½¦è¾†ä¸­å¿ƒ</div>
                </a>
                <a href="/charge/" class="app-icon">
                    <div class="app-icon-img green">ğŸ”‹</div>
                    <div class="app-name">å……ç”µç®¡ç†</div>
                </a>
                <a href="#" onclick="launchIntegratedDemo(); return false;" class="app-icon">
                    <div class="app-icon-img purple">ğŸ”„</div>
                    <div class="app-name">æ‰‹åŠ¿è¯†åˆ«å’Œç–²åŠ³æ£€æµ‹</div>
                </a>
                <a href="/record/" class="app-icon">
                    <div class="app-icon-img purple">ğŸ“¹</div>
                    <div class="app-name">è¡Œè½¦è®°å½•</div>
                </a>
                <a href="/bluetooth/" class="app-icon">
                    <div class="app-icon-img green">ğŸ“</div>
                    <div class="app-name">è“ç‰™ç”µè¯</div>
                </a>
                <a href="/navigation/" class="app-icon">
                    <div class="app-icon-img red">ğŸ¯</div>
                    <div class="app-name">é«˜å¾·å¯¼èˆª</div>
                </a>
            </div>

            <div class="section-title">å…¨éƒ¨åº”ç”¨</div>
            <div class="app-grid">
                <div class="app-icon">
                    <a href="speech/" id="speech-recognition-icon">
                        <div class="app-icon-img purple">ğŸ¤</div>
                        <div class="app-name">è¯­éŸ³è¯†åˆ«</div>
                    </a>
                </div>
                <div class="app-icon">
                    <a href="#" onclick="launchIntegratedDemo(); return false;" class="app-icon">
                        <div class="app-icon-img purple">ğŸ”„</div>
                        <div class="app-name">æ‰‹åŠ¿è¯†åˆ«å’Œç–²åŠ³æ£€æµ‹</div>
                    </a>
                </div>
                <div class="app-icon">
                    <div class="app-icon-img blue">ğŸ§­</div>
                    <div class="app-name">åœ°å›¾</div>
                </div>
                <div class="app-icon">
                    <a href="/gaze/start/" class="app-icon">
                        <div class="app-icon-img blue">ğŸ‘€</div>
                        <div class="app-name">è§†çº¿è¯†åˆ«</div>
                    </a>
                </div>
                <div class="app-icon">
                    <div class="app-icon-img grey">ğŸ‘•</div>
                    <div class="app-name">ä¸ªäººè®¾ç½®</div>
                </div>

                <div class="app-icon">
                    <div class="app-icon-img purple">ğŸ“¹</div>
                    <div class="app-name">è¡Œè½¦è®°å½•</div>
                </div>
                <a href="https://www.bilibili.com/" target="_blank" style="text-decoration: none; color: inherit;">
                    <div class="app-icon">
                        <div class="app-icon-img blue">
                            <img src="{% static 'bilibili.png' %}" class="app-icon-img">
                        </div>
                        <div class="app-name">bilibili</div>
                    </div>
                </a>
                <a href="https://www.iqiyi.com/" target="_blank" style="text-decoration: none; color: inherit;">
                    <div class="app-icon">
                        <img src="{% static 'ai.png' %}" class="app-icon-img" >
                        <div class="app-name">çˆ±å¥‡è‰º</div>
                    </div>
                </a>
                <div class="app-icon">
                    <div class="app-icon-img blue">ğŸš—</div>
                    <div class="app-name">è½¦è¾†ä¸­å¿ƒ</div>
                </div>
                <div class="app-icon">
                    <div class="app-icon-img green">ğŸ“</div>
                    <div class="app-name">è“ç‰™ç”µè¯</div>
                </div>
                <div class="app-icon">
                    <div class="app-icon-img blue">ğŸŒ</div>
                    <div class="app-name">æµè§ˆå™¨</div>
                </div>
                <div class="app-icon">
                    <div class="app-icon-img green">ğŸ”‹</div>
                    <div class="app-name">å……ç”µç®¡ç†</div>
                </div>
            </div>

            <div class="line"></div>
            <div class="section-title">æ¸©åº¦è°ƒèŠ‚</div>
            <div class="bottom-controls" style="display: flex; justify-content: space-between; align-items: center;">
                <div class="temp-control" style="display: flex; align-items: center; gap: 15px;">
                    <button class="control-btn" id="decrease-btn">â–</button>
                    <div class="temp-value" id="temp-value">{{ temperature|floatformat:"1" }}Â°</div>
                    <button class="control-btn" id="increase-btn">â•</button>
                    <div class="air-mode-controls" style="display: flex; gap: 10px;">
                        <button class="control-btn" id="cool-btn">â„ï¸</button>
                        <button class="control-btn" id="heat-btn">ğŸ”¥</button>
                        <button class="control-btn" id="nature-btn">ğŸƒ</button>
                    </div>
                </div>
            </div>
            <div class="weather-widget" id="ww_c68eb251cf771" v='1.3' loc='id' a='{"t":"horizontal","lang":"zh","sl_lpl":1,"ids":["wl384"],"font":"Arial","sl_ics":"one_a","sl_sot":"fahrenheit","cl_bkg":"image","cl_font":"#FFFFFF","cl_cloud":"#FFFFFF","cl_persp":"#81D4FA","cl_sun":"#FFC107","cl_moon":"#FFC107","cl_thund":"#FF5722"}'><a href="https://weatherwidget.org/" id="ww_c68eb251cf771_u" target="_blank">weatherwidget.org</a></div>
            
        </div>
    </div>



    <script async src="https://app3.weatherwidget.org/js/?id=ww_c68eb251cf771"></script>
    <script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.15&key=YOUR_AMAP_API_KEY"></script>
    <script type="text/javascript">
        var map = new AMap.Map('map-container', {
            zoom: 15,
            center: [117.346194, 38.988726]
        });

        // åœ¨è¿™é‡Œæ·»åŠ  resize() è°ƒç”¨
        map.resize();

        // Get the icon that opens speech recognition
        var icon = document.getElementById("speech-recognition-icon");

        // When the user clicks the icon, redirect to speech recognition page
        icon.onclick = function(event) {
            event.preventDefault(); // Prevent default anchor behavior
            window.location.href = '/speech/recognize/';
        }

        // å®šæœŸæ£€æŸ¥å”¤é†’è¯çŠ¶æ€
        function checkWakeWordStatus() {
            fetch('/speech/check-wake-word/')
                .then(response => response.json())
                .then(data => {
                    if (data.wake_word_detected) {
                        console.log('æ£€æµ‹åˆ°å”¤é†’è¯ï¼Œè·³è½¬åˆ°è¯­éŸ³è¯†åˆ«é¡µé¢');
                        window.location.href = '/speech/recognize/';
                    }
                })
                .catch(error => {
                    console.error('æ£€æŸ¥å”¤é†’è¯çŠ¶æ€æ—¶å‡ºé”™:', error);
                });
        }

        // æ¯2ç§’æ£€æŸ¥ä¸€æ¬¡å”¤é†’è¯çŠ¶æ€
        setInterval(checkWakeWordStatus, 2000);
        
        // é¡µé¢åŠ è½½æ—¶ç«‹å³æ£€æŸ¥ä¸€æ¬¡
        checkWakeWordStatus();

    </script>

    <script>
        const staticPath = "{% static 'music/' %}";
        const songs = [
            {
                title: "æµ®å…‰",
                artist: "å‘¨æ·±",
                file: "song1.mp3",
                cover: "cover1.jpg"
            },
            {
                title: "seven",
                artist: "Zenia",
                file: "song2.mp3",
                cover: "cover2.jpg"
            },
            {
                title: "å¿—é“­",
                artist: "çŠ¬å„’ä¹é˜Ÿ",
                file: "song3.mp3",
                cover: "cover3.jpg"
            }
        ];

        let currentIndex = 0;
        let isPlaying = false;

        const audio = new Audio();  // çº¯JSéŸ³é¢‘å¯¹è±¡
        const cover = document.getElementById("cover");
        const title = document.getElementById("title");
        const artist = document.getElementById("artist");
        const playBtn = document.getElementById("playBtn");
        const progress = document.getElementById("progress");  // è¿›åº¦æ¡å¡«å……å±‚
        const progressContainer = document.getElementById("progressContainer");  // è¿›åº¦æ¡å®¹å™¨

        function loadSong(index) {
            const song = songs[index];
            audio.src = staticPath + song.file;
            cover.src = staticPath + song.cover;
            title.textContent = song.title;
            artist.textContent = song.artist;
        }

        function playSong() {
            audio.play();
            isPlaying = true;
            playBtn.textContent = "â¸ï¸";
        }

        function pauseSong() {
            audio.pause();
            isPlaying = false;
            playBtn.textContent = "â–¶ï¸";
        }

        function togglePlay() {
            isPlaying ? pauseSong() : playSong();
        }

        function prevSong() {
            currentIndex = (currentIndex - 1 + songs.length) % songs.length;
            loadSong(currentIndex);
            playSong();
        }

        function nextSong() {
            currentIndex = (currentIndex + 1) % songs.length;
            loadSong(currentIndex);
            playSong();
        }

        // éŸ³é¢‘æ’­æ”¾ç»“æŸè‡ªåŠ¨ä¸‹ä¸€é¦–
        audio.addEventListener("ended", nextSong);

        // ç›‘å¬æ’­æ”¾è¿›åº¦ï¼Œæ›´æ–°è¿›åº¦æ¡å®½åº¦
        audio.addEventListener("timeupdate", () => {
            if (audio.duration) {
                const percent = (audio.currentTime / audio.duration) * 100;
                progress.style.width = percent + "%";
            }
        });

        // ç‚¹å‡»è¿›åº¦æ¡è°ƒæ•´æ’­æ”¾æ—¶é—´
        progressContainer.addEventListener("click", (e) => {
            const width = progressContainer.clientWidth;
            const clickX = e.offsetX;
            const duration = audio.duration;
            if (duration) {
                audio.currentTime = (clickX / width) * duration;
            }
        });

        // ç»‘å®šæŒ‰é’®äº‹ä»¶
        playBtn.addEventListener("click", togglePlay);
        document.getElementById("prevBtn").addEventListener("click", prevSong);
        document.getElementById("nextBtn").addEventListener("click", nextSong);

        // åˆå§‹åŒ–åŠ è½½ç¬¬ä¸€é¦–æ­Œ
        loadSong(currentIndex);
    </script>

    <script>
        function launchIntegratedDemo() {
            fetch('/integrated/launch/', {
                method: 'POST',
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    console.log('é›†æˆç³»ç»Ÿå·²å¯åŠ¨');
                    // å¯åŠ¨æˆåŠŸåè·³è½¬åˆ°welcomeé¡µé¢
                    window.location.href = '/integrated/welcome';
                } else {
                    alert('å¯åŠ¨å¤±è´¥: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('å¯åŠ¨è¯·æ±‚å¤±è´¥');
            });
        }
    </script>

    <script>
        // åˆå§‹æ¸©åº¦ï¼Œå–æ¨¡æ¿é‡Œçš„æ•°å­—ï¼Œå»æ‰æœ«å°¾çš„ 'Â°' å¹¶è½¬æˆæ•°å­—
        let tempValueElem = document.getElementById('temp-value');
        let temperature = parseInt(tempValueElem.textContent);

        // å‡å°‘æŒ‰é’®
        document.getElementById('decrease-btn').addEventListener('click', () => {
            temperature-=0.5;
            tempValueElem.textContent = temperature.toFixed(1) + 'Â°';
        });

        // å¢åŠ æŒ‰é’®
        document.getElementById('increase-btn').addEventListener('click', () => {
            temperature+=0.5;
            tempValueElem.textContent = temperature.toFixed(1) + 'Â°';
        });

        // æ¨¡å¼æŒ‰é’®æ§åˆ¶
        const modeButtons = {
            cool: document.getElementById('cool-btn'),
            heat: document.getElementById('heat-btn'),
            fan: document.getElementById('nature-btn')
        };

        console.log('æ¨¡å¼æŒ‰é’®å…ƒç´ :', modeButtons);

        let activeMode = null; // å£°æ˜å¹¶åˆå§‹åŒ– activeMode å˜é‡

        function toggleMode(mode) {
            console.log('ç‚¹å‡»äº†æ¨¡å¼æŒ‰é’®:', mode);
            if (activeMode === mode) {
                // å¦‚æœç‚¹å‡»å½“å‰æ¿€æ´»çš„æ¨¡å¼ï¼Œåˆ™å…³é—­å®ƒ
                modeButtons[mode].classList.remove('active');
                activeMode = null;
            } else {
                // å¦‚æœç‚¹å‡»å…¶ä»–æ¨¡å¼ï¼Œå…ˆå…³é—­å½“å‰æ¨¡å¼ï¼Œå†æ¿€æ´»æ–°æ¨¡å¼
                if (activeMode) {
                    if (modeButtons[activeMode]) {
                        modeButtons[activeMode].classList.remove('active');
                    }
                }
                if (modeButtons[mode]) {
                   modeButtons[mode].classList.add('active');
                   activeMode = mode;
                }
            }
        }

        // ä¸ºæ¯ä¸ªæ¨¡å¼æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
        if (modeButtons.cool) {
            modeButtons.cool.addEventListener('click', () => toggleMode('cool'));
            console.log('åˆ¶å†·æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨å·²æ·»åŠ ');
        }
        if (modeButtons.heat) {
            modeButtons.heat.addEventListener('click', () => toggleMode('heat'));
            console.log('åˆ¶çƒ­æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨å·²æ·»åŠ ');
        }
        if (modeButtons.fan) {
            modeButtons.fan.addEventListener('click', () => toggleMode('fan'));
            console.log('è‡ªç„¶é£æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨å·²æ·»åŠ ');
        }
    </script>
    <script>
function updateTime() {
    const now = new Date();
    const hours = String(now.getHours()).padStart(2, '0');
    const minutes = String(now.getMinutes()).padStart(2, '0');
    document.getElementById('current-time').textContent = `${hours}:${minutes}`;
}
setInterval(updateTime, 1000); // æ¯ç§’æ›´æ–°ä¸€æ¬¡
updateTime(); // åˆå§‹åŒ–
</script>

</body>
</html>