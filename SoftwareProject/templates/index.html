{% load static %}
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f2f5;
            color: #333;
            overflow-x: hidden;
        }
        .dashboard {
            display: flex;
            min-height: 100vh;
            max-width: 1400px;
            margin: 0 auto;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            padding-top: 12px;  /* Ê∑ªÂä†Ëøô‰∏ÄË°åÔºåËÆ©ÂÆÉÈÅøÂºÄÂØºËà™Ê†è */
        }
        .left-panel {
            flex: 1;
            background-color: #fff;
            padding: 20px;
            border-right: 1px solid #eee;
            display: flex;
            flex-direction: column;
        }
        .right-panel {
            flex: 1.2;
            padding: 20px;
            background-color: #fff;
        }
        .car-view {
            text-align: center;
            position: relative;
            margin-bottom: 0px;
            margin-top: 20px;
            height: 560px;
        }
        .car-status {
            font-size: 60px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .car-image {
            max-width: 70%;
            margin: 0 auto;
        }
        .car-controls {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        .control-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            border: none;
            cursor: pointer;
        }
        .control-btn.active {
            background-color: #1890ff;
            color: white;
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(24,144,255,0.3);
        }
        .media-player {
            background-color: #f9f9f9;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }
        .media-info {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .media-thumbnail {
            width: 50px;
            height: 50px;
            border-radius: 5px;
            background-color: #ddd;
            margin-right: 10px;
        }
        .media-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }
        .media-btn {
            border: none;
            background: none;
            cursor: pointer;
            font-size: 20px;
            color: #666;
        }
        #title {
            font-size: 20px;
            font-weight: 600;
            color: #222;
            margin-bottom: 4px;
        }
        #artist {
            font-size: 14px;
            color: #777;
        }
        .progress-container {
            width: 100%;
            height: 8px;
            background: #eee;
            border-radius: 4px;
            margin-top: 10px;
            cursor: pointer;
            position: relative;
        }
        .progress {
            height: 100%;
            width: 0%;
            background: linear-gradient(to right, #ff6a00, #ffb347);
            border-radius: 4px;
            transition: width 0.2s linear;
        }

        .section-title {
            font-size: 16px;
            color: #666;
            margin: 20px 0 15px;
        }
        .app-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        .app-grid a {
            text-decoration: none;
            color: inherit;
        }
        .app-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .app-icon:hover {
            transform: scale(1.05);
        }
        .app-icon-img {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background-color: #e6f7ff;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px;
            color: #1890ff;
        }
        .app-icon-img.blue {
            background-color: #e6f7ff;
            color: #1890ff;
        }
        .app-icon-img.green {
            background-color: #e6ffe6;
            color: #52c41a;
        }
        .app-icon-img.orange {
            background-color: #fff7e6;
            color: #fa8c16;
        }
        .app-icon-img.purple {
            background-color: #f9f0ff;
            color: #722ed1;
        }
        .app-icon-img.red {
            background-color: #fff1f0;
            color: #f5222d;
        }
        .app-icon-img.grey {
            background-color: #f5f5f5;
            color: #666;
        }
        .app-name {
            font-size: 12px;
            color: #666;
        }
        .bottom-controls {
            display: flex;
            justify-content: space-between;
            padding-top: 0px;
            margin-top: 0px;
        }
        .temp-control {
            display: flex;
            height: 60px;
            align-items: center;
            margin-bottom: 20px;
        }
        .temp-value {
            font-size: 18px;
            margin: 0 10px;
        }
        .line {
            border-bottom: 1px solid #eee;
        }
        .weather-widget {
            width: 100%;
            border-radius: 16px;
            overflow: hidden;
            box-sizing: border-box;
            margin-top: 10px;
        }


        .status-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 98%;
            height: 32px;
            background-color: #fff;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .status-left {
            display: flex;
            gap: 16px;
            align-items: center;
            flex-shrink: 0;
        }
        .status-right {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-shrink: 0;
        }
        .status-icon {
            width: 16px;
            height: 16px;
            object-fit: contain;
        }
        .status-right a {
            color: #1890ff !important;
            text-decoration: none;
            font-weight: 500;
            padding: 2px 8px;
            border-radius: 6px;
            transition: background 0.2s, color 0.2s;
        }

        .status-right a:hover {
            background-color: #e6f7ff;
            color: #096dd9;
            text-decoration: none;
        }

    </style>
</head>
<body>
    <div class="dashboard">
        <div class="status-bar">
            <div class="status-left">
                <img src="{% static 'P.png' %}" alt="P" class="status-icon">
                <img src="{% static 'rain.png' %}" alt="rain" class="status-icon">
                <img src="{% static 'light.png' %}" alt="light" class="status-icon">
            </div>
            <div class="status-right">
                <img src="{% static 'location.svg' %}" alt="‰ΩçÁΩÆ" class="status-icon">
                <img src="{% static 'volume.svg' %}" alt="Èü≥Èáè" class="status-icon">
                <img src="{% static 'wifi.svg' %}" alt="‰ø°Âè∑" class="status-icon">
                <span id="current-time">--:--</span>
                 <!-- ÁôªÂΩï/Ê≥®ÂÜåÊàñÁî®Êà∑‰ø°ÊÅØ -->
                {% if user.is_authenticated %}
                    <span style="margin-left: 10px; font-size: 14px;">Ê¨¢ËøéÔºå{{ user.username }}</span>
                    <a href="{% url 'logout' %}" style="margin-left: 10px; font-size: 14px;">ÈÄÄÂá∫</a>
                {% else %}
                    <a href="{% url 'login' %}" style="margin-left: 10px; font-size: 14px;">ÁôªÂΩï</a>
                    <a href="{% url 'register' %}" style="margin-left: 10px; font-size: 14px;">Ê≥®ÂÜå</a>
                {% endif %}
            </div>
        </div>
        <div class="left-panel">
            <div class="car-view">
                <div id="map-container" style="width: 100%; height: 100%;"></div>
            </div>
            
            <div class="media-player">
                <div class="media-info">
                    <img id="cover" class="media-thumbnail" src="{% static 'music/cover1.jpg' %}" alt="Â∞ÅÈù¢">
                    <div>
                        <div id="title">ÊµÆÂÖâ</div>
                        <div id="artist">Âë®Ê∑±</div>
                    </div>
                </div>
                <div class="progress-container" id="progressContainer">
                    <div class="progress" id="progress"></div>
                </div>
                <div class="media-controls">
                    <button class="media-btn" id="prevBtn">‚èÆÔ∏è</button>
                    <button class="media-btn play-btn" id="playBtn">‚ñ∂Ô∏è</button>
                    <button class="media-btn" id="nextBtn">‚è≠Ô∏è</button>
                    <button class="media-btn">‚ù§Ô∏è</button>
                    <button class="media-btn">üîÑ</button>
                </div>
            </div>
        </div>

        <div class="right-panel">
            <div class="section-title">ÊúÄËøëÂ∫îÁî®</div>
            <div class="app-grid">
                <a href="/car/" class="app-icon">
                    <div class="app-icon-img blue">üöó</div>
                    <div class="app-name">ËΩ¶ËæÜ‰∏≠ÂøÉ</div>
                </a>
                <a href="/charge/" class="app-icon">
                    <div class="app-icon-img green">üîã</div>
                    <div class="app-name">ÂÖÖÁîµÁÆ°ÁêÜ</div>
                </a>
                <a href="#" onclick="launchIntegratedDemo(); return false;" class="app-icon">
                    <div class="app-icon-img purple">üîÑ</div>
                    <div class="app-name">ÊâãÂäøËØÜÂà´ÂíåÁñ≤Âä≥Ê£ÄÊµã</div>
                </a>
                <a href="/record/" class="app-icon">
                    <div class="app-icon-img purple">üìπ</div>
                    <div class="app-name">Ë°åËΩ¶ËÆ∞ÂΩï</div>
                </a>
                <a href="/bluetooth/" class="app-icon">
                    <div class="app-icon-img green">üìû</div>
                    <div class="app-name">ËìùÁâôÁîµËØù</div>
                </a>
                <a href="/navigation/" class="app-icon">
                    <div class="app-icon-img red">üéØ</div>
                    <div class="app-name">È´òÂæ∑ÂØºËà™</div>
                </a>
            </div>

            <div class="section-title">ÂÖ®ÈÉ®Â∫îÁî®</div>
            <div class="app-grid">
                <div class="app-icon">
                    <a href="speech/" id="speech-recognition-icon">
                        <div class="app-icon-img purple">üé§</div>
                        <div class="app-name">ËØ≠Èü≥ËØÜÂà´</div>
                    </a>
                </div>
                <div class="app-icon">
                    <a href="#" onclick="launchIntegratedDemo(); return false;" class="app-icon">
                        <div class="app-icon-img purple">üîÑ</div>
                        <div class="app-name">ÊâãÂäøËØÜÂà´ÂíåÁñ≤Âä≥Ê£ÄÊµã</div>
                    </a>
                </div>
                <div class="app-icon">
                    <div class="app-icon-img blue">üß≠</div>
                    <div class="app-name">Âú∞Âõæ</div>
                </div>
                <div class="app-icon">
                    <a href="/gaze/start/" class="app-icon">
                        <div class="app-icon-img blue">üëÄ</div>
                        <div class="app-name">ËßÜÁ∫øËØÜÂà´</div>
                    </a>
                </div>
                <div class="app-icon">
                    <div class="app-icon-img grey">üëï</div>
                    <div class="app-name">‰∏™‰∫∫ËÆæÁΩÆ</div>
                </div>

                <div class="app-icon">
                    <div class="app-icon-img purple">üìπ</div>
                    <div class="app-name">Ë°åËΩ¶ËÆ∞ÂΩï</div>
                </div>
                <a href="https://www.bilibili.com/" target="_blank" style="text-decoration: none; color: inherit;">
                    <div class="app-icon">
                        <div class="app-icon-img blue">
                            <img src="{% static 'bilibili.png' %}" class="app-icon-img">
                        </div>
                        <div class="app-name">bilibili</div>
                    </div>
                </a>
                <a href="https://www.iqiyi.com/" target="_blank" style="text-decoration: none; color: inherit;">
                    <div class="app-icon">
                        <img src="{% static 'ai.png' %}" class="app-icon-img" >
                        <div class="app-name">Áà±Â•áËâ∫</div>
                    </div>
                </a>
                <div class="app-icon">
                    <div class="app-icon-img blue">üöó</div>
                    <div class="app-name">ËΩ¶ËæÜ‰∏≠ÂøÉ</div>
                </div>
                <div class="app-icon">
                    <div class="app-icon-img green">üìû</div>
                    <div class="app-name">ËìùÁâôÁîµËØù</div>
                </div>
                <div class="app-icon">
                    <div class="app-icon-img blue">üåê</div>
                    <div class="app-name">ÊµèËßàÂô®</div>
                </div>
                <div class="app-icon">
                    <div class="app-icon-img green">üîã</div>
                    <div class="app-name">ÂÖÖÁîµÁÆ°ÁêÜ</div>
                </div>
            </div>

            <div class="line"></div>
            <div class="section-title">Ê∏©Â∫¶Ë∞ÉËäÇ</div>
            <div class="bottom-controls" style="display: flex; justify-content: space-between; align-items: center;">
                <div class="temp-control" style="display: flex; align-items: center; gap: 15px;">
                    <button class="control-btn" id="decrease-btn">‚ûñ</button>
                    <div class="temp-value" id="temp-value">{{ temperature|floatformat:"1" }}¬∞</div>
                    <button class="control-btn" id="increase-btn">‚ûï</button>
                    <div class="air-mode-controls" style="display: flex; gap: 10px;">
                        <button class="control-btn" id="cool-btn">‚ùÑÔ∏è</button>
                        <button class="control-btn" id="heat-btn">üî•</button>
                        <button class="control-btn" id="nature-btn">üçÉ</button>
                    </div>
                </div>
            </div>
            <div class="weather-widget" id="ww_c68eb251cf771" v='1.3' loc='id' a='{"t":"horizontal","lang":"zh","sl_lpl":1,"ids":["wl384"],"font":"Arial","sl_ics":"one_a","sl_sot":"fahrenheit","cl_bkg":"image","cl_font":"#FFFFFF","cl_cloud":"#FFFFFF","cl_persp":"#81D4FA","cl_sun":"#FFC107","cl_moon":"#FFC107","cl_thund":"#FF5722"}'><a href="https://weatherwidget.org/" id="ww_c68eb251cf771_u" target="_blank">weatherwidget.org</a></div>
            
        </div>
    </div>



    <script async src="https://app3.weatherwidget.org/js/?id=ww_c68eb251cf771"></script>
    <script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.15&key=YOUR_AMAP_API_KEY"></script>
    <script type="text/javascript">
        var map = new AMap.Map('map-container', {
            zoom: 15,
            center: [117.346194, 38.988726]
        });

        // Âú®ËøôÈáåÊ∑ªÂä† resize() Ë∞ÉÁî®
        map.resize();

        // Get the icon that opens speech recognition
        var icon = document.getElementById("speech-recognition-icon");

        // When the user clicks the icon, redirect to speech recognition page
        icon.onclick = function(event) {
            event.preventDefault(); // Prevent default anchor behavior
            window.location.href = '/speech/recognize/';
        }

        // ÂÆöÊúüÊ£ÄÊü•Âî§ÈÜíËØçÁä∂ÊÄÅ
        function checkWakeWordStatus() {
            fetch('/speech/check-wake-word/')
                .then(response => response.json())
                .then(data => {
                    if (data.wake_word_detected) {
                        console.log('Ê£ÄÊµãÂà∞Âî§ÈÜíËØçÔºåË∑≥ËΩ¨Âà∞ËØ≠Èü≥ËØÜÂà´È°µÈù¢');
                        window.location.href = '/speech/recognize/';
                    }
                })
                .catch(error => {
                    console.error('Ê£ÄÊü•Âî§ÈÜíËØçÁä∂ÊÄÅÊó∂Âá∫Èîô:', error);
                });
        }

        // ÊØè2ÁßíÊ£ÄÊü•‰∏ÄÊ¨°Âî§ÈÜíËØçÁä∂ÊÄÅ
        setInterval(checkWakeWordStatus, 2000);
        
        // È°µÈù¢Âä†ËΩΩÊó∂Á´ãÂç≥Ê£ÄÊü•‰∏ÄÊ¨°
        checkWakeWordStatus();

    </script>

    <script>
        const staticPath = "{% static 'music/' %}";
        const songs = [
            {
                title: "ÊµÆÂÖâ",
                artist: "Âë®Ê∑±",
                file: "song1.mp3",
                cover: "cover1.jpg"
            },
            {
                title: "seven",
                artist: "Zenia",
                file: "song2.mp3",
                cover: "cover2.jpg"
            },
            {
                title: "ÂøóÈì≠",
                artist: "Áä¨ÂÑí‰πêÈòü",
                file: "song3.mp3",
                cover: "cover3.jpg"
            }
        ];

        let currentIndex = 0;
        let isPlaying = false;

        const audio = new Audio();  // Á∫ØJSÈü≥È¢ëÂØπË±°
        const cover = document.getElementById("cover");
        const title = document.getElementById("title");
        const artist = document.getElementById("artist");
        const playBtn = document.getElementById("playBtn");
        const progress = document.getElementById("progress");  // ËøõÂ∫¶Êù°Â°´ÂÖÖÂ±Ç
        const progressContainer = document.getElementById("progressContainer");  // ËøõÂ∫¶Êù°ÂÆπÂô®

        function loadSong(index) {
            const song = songs[index];
            audio.src = staticPath + song.file;
            cover.src = staticPath + song.cover;
            title.textContent = song.title;
            artist.textContent = song.artist;
        }

        function playSong() {
            audio.play();
            isPlaying = true;
            playBtn.textContent = "‚è∏Ô∏è";
        }

        function pauseSong() {
            audio.pause();
            isPlaying = false;
            playBtn.textContent = "‚ñ∂Ô∏è";
        }

        function togglePlay() {
            isPlaying ? pauseSong() : playSong();
        }

        function prevSong() {
            currentIndex = (currentIndex - 1 + songs.length) % songs.length;
            loadSong(currentIndex);
            playSong();
        }

        function nextSong() {
            currentIndex = (currentIndex + 1) % songs.length;
            loadSong(currentIndex);
            playSong();
        }

        // Èü≥È¢ëÊí≠ÊîæÁªìÊùüËá™Âä®‰∏ã‰∏ÄÈ¶ñ
        audio.addEventListener("ended", nextSong);

        // ÁõëÂê¨Êí≠ÊîæËøõÂ∫¶ÔºåÊõ¥Êñ∞ËøõÂ∫¶Êù°ÂÆΩÂ∫¶
        audio.addEventListener("timeupdate", () => {
            if (audio.duration) {
                const percent = (audio.currentTime / audio.duration) * 100;
                progress.style.width = percent + "%";
            }
        });

        // ÁÇπÂáªËøõÂ∫¶Êù°Ë∞ÉÊï¥Êí≠ÊîæÊó∂Èó¥
        progressContainer.addEventListener("click", (e) => {
            const width = progressContainer.clientWidth;
            const clickX = e.offsetX;
            const duration = audio.duration;
            if (duration) {
                audio.currentTime = (clickX / width) * duration;
            }
        });

        // ÁªëÂÆöÊåâÈíÆ‰∫ã‰ª∂
        playBtn.addEventListener("click", togglePlay);
        document.getElementById("prevBtn").addEventListener("click", prevSong);
        document.getElementById("nextBtn").addEventListener("click", nextSong);

        // ÂàùÂßãÂåñÂä†ËΩΩÁ¨¨‰∏ÄÈ¶ñÊ≠å
        loadSong(currentIndex);
    </script>

    <script>
        function launchIntegratedDemo() {
            fetch('/integrated/launch/', {
                method: 'POST',
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    console.log('ÈõÜÊàêÁ≥ªÁªüÂ∑≤ÂêØÂä®');
                    // ÂêØÂä®ÊàêÂäüÂêéË∑≥ËΩ¨Âà∞welcomeÈ°µÈù¢
                    window.location.href = '/integrated/welcome';
                } else {
                    alert('ÂêØÂä®Â§±Ë¥•: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('ÂêØÂä®ËØ∑Ê±ÇÂ§±Ë¥•');
            });
        }
    </script>

    <script>
        // ÂàùÂßãÊ∏©Â∫¶ÔºåÂèñÊ®°ÊùøÈáåÁöÑÊï∞Â≠óÔºåÂéªÊéâÊú´Â∞æÁöÑ '¬∞' Âπ∂ËΩ¨ÊàêÊï∞Â≠ó
        let tempValueElem = document.getElementById('temp-value');
        let temperature = parseInt(tempValueElem.textContent);

        // ÂáèÂ∞ëÊåâÈíÆ
        document.getElementById('decrease-btn').addEventListener('click', () => {
            temperature-=0.5;
            tempValueElem.textContent = temperature.toFixed(1) + '¬∞';
        });

        // Â¢ûÂä†ÊåâÈíÆ
        document.getElementById('increase-btn').addEventListener('click', () => {
            temperature+=0.5;
            tempValueElem.textContent = temperature.toFixed(1) + '¬∞';
        });

        // Ê®°ÂºèÊåâÈíÆÊéßÂà∂
        const modeButtons = {
            cool: document.getElementById('cool-btn'),
            heat: document.getElementById('heat-btn'),
            fan: document.getElementById('nature-btn')
        };

        console.log('Ê®°ÂºèÊåâÈíÆÂÖÉÁ¥†:', modeButtons);

        let activeMode = null; // Â£∞ÊòéÂπ∂ÂàùÂßãÂåñ activeMode ÂèòÈáè

        function toggleMode(mode) {
            console.log('ÁÇπÂáª‰∫ÜÊ®°ÂºèÊåâÈíÆ:', mode);
            if (activeMode === mode) {
                // Â¶ÇÊûúÁÇπÂáªÂΩìÂâçÊøÄÊ¥ªÁöÑÊ®°ÂºèÔºåÂàôÂÖ≥Èó≠ÂÆÉ
                modeButtons[mode].classList.remove('active');
                activeMode = null;
            } else {
                // Â¶ÇÊûúÁÇπÂáªÂÖ∂‰ªñÊ®°ÂºèÔºåÂÖàÂÖ≥Èó≠ÂΩìÂâçÊ®°ÂºèÔºåÂÜçÊøÄÊ¥ªÊñ∞Ê®°Âºè
                if (activeMode) {
                    if (modeButtons[activeMode]) {
                        modeButtons[activeMode].classList.remove('active');
                    }
                }
                if (modeButtons[mode]) {
                   modeButtons[mode].classList.add('active');
                   activeMode = mode;
                }
            }
        }

        // ‰∏∫ÊØè‰∏™Ê®°ÂºèÊåâÈíÆÊ∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂
        if (modeButtons.cool) {
            modeButtons.cool.addEventListener('click', () => toggleMode('cool'));
            console.log('Âà∂ÂÜ∑ÊåâÈíÆ‰∫ã‰ª∂ÁõëÂê¨Âô®Â∑≤Ê∑ªÂä†');
        }
        if (modeButtons.heat) {
            modeButtons.heat.addEventListener('click', () => toggleMode('heat'));
            console.log('Âà∂ÁÉ≠ÊåâÈíÆ‰∫ã‰ª∂ÁõëÂê¨Âô®Â∑≤Ê∑ªÂä†');
        }
        if (modeButtons.fan) {
            modeButtons.fan.addEventListener('click', () => toggleMode('fan'));
            console.log('Ëá™ÁÑ∂È£éÊåâÈíÆ‰∫ã‰ª∂ÁõëÂê¨Âô®Â∑≤Ê∑ªÂä†');
        }
    </script>
    <script>
function updateTime() {
    const now = new Date();
    const hours = String(now.getHours()).padStart(2, '0');
    const minutes = String(now.getMinutes()).padStart(2, '0');
    document.getElementById('current-time').textContent = `${hours}:${minutes}`;
}
setInterval(updateTime, 1000); // ÊØèÁßíÊõ¥Êñ∞‰∏ÄÊ¨°
updateTime(); // ÂàùÂßãÂåñ
</script>

</body>
</html>